import{a as E}from"./chunk-OIOJYRRW.js";import{a as b}from"./chunk-NOV4WKFA.js";import{a as k}from"./chunk-QK65AMJQ.js";import{d as s}from"./chunk-PXDN3KFO.js";import{useState as l,useCallback as $,useRef as a}from"react";import{CrossmintWalletBaseProvider as z,useCrossmint as G}from"@crossmint/client-sdk-react-base";import{jsx as h,jsxs as J}from"react/jsx-runtime";var p=P=>()=>{throw new Error(`${P} is not available. Make sure you're using an email or phone signer wallet.`)};function L({children:P,showPasskeyHelpers:d=!0,appearance:m,createOnLogin:o,callbacks:i}){let{experimental_customAuth:t}=G(),[W,c]=l({open:!1}),[D,y]=l(!1),[F,N]=l("initial"),[j,f]=l(!1),[q,V]=l("initial"),A=a(!1),S=a(p("sendEmailWithOtp")),u=a(p("verifyOtp")),v=a(p("sendPhoneWithOtp")),g=a(p("verifyPhoneOtp")),n=a(p("reject")),C=(o==null?void 0:o.signer.type)==="phone"&&(o==null?void 0:o.signer.phone)!=null?o.signer.phone:t==null?void 0:t.phone,T=$(e=>()=>new Promise(r=>{if(!d){r();return}c({type:e,open:!0,primaryActionOnClick:()=>{c({open:!1}),r()},secondaryActionOnClick:()=>{c({open:!1}),r()}})}),[d]),R=()=>s(this,null,function*(){try{yield S.current(),N("otp")}catch(e){console.error("Failed to send email OTP",e),n.current(new Error("Failed to send email OTP"))}}),B=e=>s(this,null,function*(){try{yield u.current(e),y(!1)}catch(r){console.error("Failed to verify OTP",r),n.current(new Error("Failed to verify OTP"))}}),w=()=>s(this,null,function*(){try{yield v.current(),V("otp")}catch(e){console.error("Failed to send phone OTP",e),n.current(new Error("Failed to send phone OTP"))}}),I=e=>s(this,null,function*(){try{yield g.current(e),f(!1)}catch(r){console.error("Failed to verify phone OTP",r),n.current(new Error("Failed to verify phone OTP"))}});return J(z,{createOnLogin:o,onAuthRequired:(e,r,O,U)=>s(this,null,function*(){(o==null?void 0:o.signer.type)==="phone"&&o.signer.phone?(f(e),v.current=r,g.current=O):(y(e),S.current=r,u.current=O),A.current=e,n.current=U}),callbacks:(()=>{let e=i==null?void 0:i.onWalletCreationStart,r=i==null?void 0:i.onTransactionStart;return(o==null?void 0:o.signer.type)==="passkey"&&d&&(e=T("create-wallet"),r=T("transaction")),{onWalletCreationStart:e,onTransactionStart:r}})(),children:[P,h(E,{rejectRef:n,email:t==null?void 0:t.email,open:D&&(t==null?void 0:t.email)!=null,setOpen:y,step:F,onSubmitOTP:B,onResendOTPCode:R,onSubmitEmail:R,appearance:m}),h(b,{rejectRef:n,phone:C,open:j&&C!=null,setOpen:f,step:q,onSubmitOTP:I,onResendOTPCode:w,onSubmitPhone:w,appearance:m}),h(k,{state:W,appearance:m})]})}export{L as a};
