"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }var _chunk6ZTDDV6Kcjs = require('./chunk-6ZTDDV6K.cjs');var _chunkAYAK5PS7cjs = require('./chunk-AYAK5PS7.cjs');var _chunkTDIOMMXQcjs = require('./chunk-TDIOMMXQ.cjs');var _chunk7QDOU5DAcjs = require('./chunk-7QDOU5DA.cjs');var _chunkCK4JCQY6cjs = require('./chunk-CK4JCQY6.cjs');var _bs58 = require('bs58'); var _bs582 = _interopRequireDefault(_bs58);var _tweetnacl = require('tweetnacl'); var _tweetnacl2 = _interopRequireDefault(_tweetnacl);function x(t,e){if(S(t))return{isValid:!1,message:"Old API key format detected. Please create a new API key from the Crossmint console."};let i=v(t);if(i==null)return{isValid:!1,message:`Malformed API key. Must start with '${_chunk7QDOU5DAcjs.a.CLIENT}' or '${_chunk7QDOU5DAcjs.a.SERVER}'.`};if((e==null?void 0:e.usageOrigin)!=null&&i!==e.usageOrigin)return{isValid:!1,message:`Disallowed API key. You passed a ${i} API key, but a ${e.usageOrigin} API key is required.`};let r=O(t);return r==null?{isValid:!1,message:`Malformed API key. Must have a valid environment: '${_chunk7QDOU5DAcjs.b.DEVELOPMENT}', '${_chunk7QDOU5DAcjs.b.STAGING}' or '${_chunk7QDOU5DAcjs.b.PRODUCTION}'.`}:(e==null?void 0:e.environment)!=null&&r!==e.environment?{isValid:!1,message:`Disallowed API key. You passed a ${r} API key, but a ${e.environment} API key is required.`}:{isValid:!0,usageOrigin:i,environment:r,prefix:`${_chunkAYAK5PS7cjs.a.call(void 0, i)}_${r}`}}function S(t){return t.startsWith("sk_live")||t.startsWith("sk_test")}function v(t){return t.startsWith(_chunk7QDOU5DAcjs.a.CLIENT+"_")?_chunk7QDOU5DAcjs.c.CLIENT:t.startsWith(_chunk7QDOU5DAcjs.a.SERVER+"_")?_chunk7QDOU5DAcjs.c.SERVER:null}function O(t){let e=t.slice(3);return e.startsWith(_chunk7QDOU5DAcjs.b.DEVELOPMENT+"_")?_chunk7QDOU5DAcjs.b.DEVELOPMENT:e.startsWith(_chunk7QDOU5DAcjs.b.STAGING+"_")?_chunk7QDOU5DAcjs.b.STAGING:e.startsWith(_chunk7QDOU5DAcjs.b.PRODUCTION+"_")?_chunk7QDOU5DAcjs.b.PRODUCTION:null}function R(t,e){let i=x(t,e);if(!i.isValid)return i;let{prefix:r}=i,{keyData:n,keyDataWithoutPrefix:s,signature:l}=D(t,r);if(!T(n,l,e))return{isValid:!1,message:"Invalid API key. Failed to validate signature"};let[u]=s.split(".");return _chunkCK4JCQY6cjs.b.call(void 0, _chunkCK4JCQY6cjs.a.call(void 0, {},i),{projectId:u})}function D(t,e){let i=t.slice(`${e}_`.length),r=_bs582.default.decode(i),n=new TextDecoder().decode(r),[s,l]=n.split(":");return{keyData:`${e}.${s}`,keyDataWithoutPrefix:s,signature:l}}function T(t,e,i){let r=_chunk6ZTDDV6Kcjs.a.call(void 0, i==null?void 0:i.environment);function n(s){try{let l=_bs582.default.decode(e),P=new TextEncoder().encode(t),u=_bs582.default.decode(s);return _tweetnacl2.default.sign.detached.verify(P,l,u)}catch(l){return console.error("Failed to validate API key signature"),!1}}return r!=null?n(r):n(_chunkTDIOMMXQcjs.b)||n(_chunkTDIOMMXQcjs.a)}var k={development:_chunkTDIOMMXQcjs.c,staging:_chunkTDIOMMXQcjs.d,production:_chunkTDIOMMXQcjs.e};function X(t){let e=R(t);if(!e.isValid)throw new Error("Crossmint API key is invalid");return k[e.environment]}exports.a = X; exports.b = x; exports.c = O; exports.d = R;
