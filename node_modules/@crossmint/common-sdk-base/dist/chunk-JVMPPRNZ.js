import{a as E}from"./chunk-WBULM2SU.js";import{a as x}from"./chunk-U4QEE6R5.js";import{a as g,b as m,c as K,d as p,e as V}from"./chunk-4RWQEYZX.js";import{a as o,b as a,c as d}from"./chunk-XAJGDBTH.js";import{a as A,b as c}from"./chunk-22GIA4MK.js";import I from"bs58";import D from"tweetnacl";function R(t,e){if(v(t))return{isValid:!1,message:"Old API key format detected. Please create a new API key from the Crossmint console."};let i=O(t);if(i==null)return{isValid:!1,message:`Malformed API key. Must start with '${o.CLIENT}' or '${o.SERVER}'.`};if((e==null?void 0:e.usageOrigin)!=null&&i!==e.usageOrigin)return{isValid:!1,message:`Disallowed API key. You passed a ${i} API key, but a ${e.usageOrigin} API key is required.`};let r=_(t);return r==null?{isValid:!1,message:`Malformed API key. Must have a valid environment: '${a.DEVELOPMENT}', '${a.STAGING}' or '${a.PRODUCTION}'.`}:(e==null?void 0:e.environment)!=null&&r!==e.environment?{isValid:!1,message:`Disallowed API key. You passed a ${r} API key, but a ${e.environment} API key is required.`}:{isValid:!0,usageOrigin:i,environment:r,prefix:`${x(i)}_${r}`}}function v(t){return t.startsWith("sk_live")||t.startsWith("sk_test")}function O(t){return t.startsWith(o.CLIENT+"_")?d.CLIENT:t.startsWith(o.SERVER+"_")?d.SERVER:null}function _(t){let e=t.slice(3);return e.startsWith(a.DEVELOPMENT+"_")?a.DEVELOPMENT:e.startsWith(a.STAGING+"_")?a.STAGING:e.startsWith(a.PRODUCTION+"_")?a.PRODUCTION:null}function S(t,e){let i=R(t,e);if(!i.isValid)return i;let{prefix:r}=i,{keyData:n,keyDataWithoutPrefix:s,signature:l}=T(t,r);if(!k(n,l,e))return{isValid:!1,message:"Invalid API key. Failed to validate signature"};let[u]=s.split(".");return c(A({},i),{projectId:u})}function T(t,e){let i=t.slice(`${e}_`.length),r=I.decode(i),n=new TextDecoder().decode(r),[s,l]=n.split(":");return{keyData:`${e}.${s}`,keyDataWithoutPrefix:s,signature:l}}function k(t,e,i){let r=E(i==null?void 0:i.environment);function n(s){try{let l=I.decode(e),P=new TextEncoder().encode(t),u=I.decode(s);return D.sign.detached.verify(P,l,u)}catch(l){return console.error("Failed to validate API key signature"),!1}}return r!=null?n(r):n(m)||n(g)}var N={development:K,staging:p,production:V};function Z(t){let e=S(t);if(!e.isValid)throw new Error("Crossmint API key is invalid");return N[e.environment]}export{Z as a,R as b,_ as c,S as d};
