"use strict";Object.defineProperty(exports, "__esModule", {value: true});var _chunk56X52ZGBcjs = require('./chunk-56X52ZGB.cjs');var _chunkCK4JCQY6cjs = require('./chunk-CK4JCQY6.cjs');var _react = require('react');var _walletssdk = require('@crossmint/wallets-sdk');function de(){let i=_react.useContext.call(void 0, I);if(!i)throw new Error("useWallet must be used within CrossmintWalletProvider");return i}var _clientsdkauth = require('@crossmint/client-sdk-auth');var _commonsdkauth = require('@crossmint/common-sdk-auth');var _jsxruntime = require('react/jsx-runtime');var P=_react.createContext.call(void 0, {crossmintAuth:void 0,logout:()=>{},status:"initializing",getUser:()=>{},login:()=>{}});function L(){let i=_react.useContext.call(void 0, P);if(i==null)throw new Error("useCrossmintAuthBase must be used within CrossmintAuthBaseProvider");return i}function _({children:i,onLoginSuccess:s,refreshRoute:u,logoutRoute:p,storageProvider:o}){let{crossmint:h}=_chunk56X52ZGBcjs.a.call(void 0, "CrossmintAuthBaseProvider must be used within CrossmintProvider"),[t,d]=_react.useState.call(void 0, void 0),[n,l]=_react.useState.call(void 0, void 0),[f,C]=_react.useState.call(void 0, !1),g=_react.useRef.call(void 0, null);_react.useEffect.call(void 0, ()=>{if(!g.current)try{g.current=_clientsdkauth.CrossmintAuth.from(h,{callbacks:{onLogout:()=>{d(void 0),l(void 0)},onTokenRefresh:r=>{d(r.user),l(r.jwt)}},refreshRoute:u,logoutRoute:p,storageProvider:o})}catch(r){console.error("Failed to initialize CrossmintAuth:",r)}},[h,u,p,o]);let e=g.current,c=_react.useCallback.call(void 0, ()=>{s==null||s()},[s]);_react.useEffect.call(void 0, ()=>{var r;if(n==null)if(o)(r=o.get)==null||r.call(o,_commonsdkauth.SESSION_PREFIX).then(a=>{a!=null&&l(a)}).finally(()=>{C(!0)});else{try{let a=_clientsdkauth.getCookie.call(void 0, _commonsdkauth.SESSION_PREFIX);l(a)}catch(a){console.error("Failed to get cookie:",a)}C(!0)}else C(!0)},[n,o]),_react.useEffect.call(void 0, ()=>{n!=null&&c()},[n,c]);let y=_react.useCallback.call(void 0, ()=>{e==null||e.logout()},[e]),x=_react.useCallback.call(void 0, ()=>_chunkCK4JCQY6cjs.c.call(void 0, this,null,function*(){if(n==null){console.log("User not logged in");return}let r=yield e==null?void 0:e.getUser();return d(r),r}),[n,e]),w=_react.useCallback.call(void 0, ()=>f?n!=null?"logged-in":"logged-out":"initializing",[n,f]),S=_react.useMemo.call(void 0, ()=>({crossmintAuth:e,logout:y,jwt:n,user:t,status:w(),getUser:x,login:()=>{}}),[e,y,n,t,f,x,w]);return _jsxruntime.jsx.call(void 0, P.Provider,{value:S,children:i})}function ne(){let i=_react.useContext.call(void 0, P);if(i==null)throw new Error("useCrossmintAuth must be used within a CrossmintAuthProvider");return i}var Re=ne;var I=_react.createContext.call(void 0, {wallet:void 0,status:"not-loaded",getOrCreateWallet:()=>Promise.resolve(void 0),onAuthRequired:void 0,clientTEEConnection:void 0});function He({children:i,createOnLogin:s,callbacks:u,onAuthRequired:p,clientTEEConnection:o}){let{crossmint:h,experimental_customAuth:t}=_chunk56X52ZGBcjs.a.call(void 0, "CrossmintWalletBaseProvider must be used within CrossmintProvider"),[d,n]=_react.useState.call(void 0, void 0),[l,f]=_react.useState.call(void 0, "not-loaded"),C=_react.useCallback.call(void 0, e=>_chunkCK4JCQY6cjs.c.call(void 0, this,null,function*(){var c,y,x,w,S,r,a,k,z,N,H,j;if(!((t==null?void 0:t.jwt)==null||l==="in-progress")){if(d!=null)return d;try{f("in-progress");let E=_walletssdk.CrossmintWallets.from(h),R=(y=(c=e.options)==null?void 0:c.experimental_callbacks)==null?void 0:y.onWalletCreationStart,q=(w=(x=e.options)==null?void 0:x.experimental_callbacks)==null?void 0:w.onTransactionStart;if(((S=e==null?void 0:e.signer)==null?void 0:S.type)==="email"){let m=(r=e.signer.email)!=null?r:t==null?void 0:t.email,b=(a=e.signer.onAuthRequired)!=null?a:p;if(m==null)throw new Error("Email not found in experimental_customAuth or signer. Please set email in experimental_customAuth or signer.");e.signer=_chunkCK4JCQY6cjs.b.call(void 0, _chunkCK4JCQY6cjs.a.call(void 0, {},e.signer),{email:m,onAuthRequired:b})}if(((k=e==null?void 0:e.signer)==null?void 0:k.type)==="phone"){let m=(z=e.signer.phone)!=null?z:t==null?void 0:t.phone,b=(N=e.signer.onAuthRequired)!=null?N:p;if(m==null)throw new Error("Phone not found in signer. Please set phone in signer.");e.signer=_chunkCK4JCQY6cjs.b.call(void 0, _chunkCK4JCQY6cjs.a.call(void 0, {},e.signer),{phone:m,onAuthRequired:b})}if(((H=e==null?void 0:e.signer)==null?void 0:H.type)==="external-wallet"){let m=((j=e.signer)==null?void 0:j.address)!=null?e.signer:t.externalWalletSigner;if(m==null)throw new Error("External wallet config not found in experimental_customAuth or signer. Please set it in experimental_customAuth or signer.");e.signer=m}let D=yield E.getOrCreateWallet({chain:e.chain,signer:e.signer,owner:e.owner,plugins:e.plugins,delegatedSigners:e.delegatedSigners,options:{clientTEEConnection:o==null?void 0:o(),experimental_callbacks:{onWalletCreationStart:R!=null?R:u==null?void 0:u.onWalletCreationStart,onTransactionStart:q!=null?q:u==null?void 0:u.onTransactionStart}}});return n(D),f("loaded"),D}catch(E){console.error("Failed to create wallet:",E),n(void 0),f("error");return}}}),[h,t]);_react.useEffect.call(void 0, ()=>{if(s!=null){if(s.signer.type==="email"&&(t==null?void 0:t.email)==null||s.signer.type==="external-wallet"&&(t==null?void 0:t.externalWalletSigner)==null&&s.signer.address==null)return;C(s)}},[s,C,t==null?void 0:t.email,t==null?void 0:t.externalWalletSigner]),_react.useEffect.call(void 0, ()=>{(t==null?void 0:t.jwt)==null&&l!=="not-loaded"&&(f("not-loaded"),n(void 0))},[t==null?void 0:t.jwt,l]);let g=_react.useMemo.call(void 0, ()=>({wallet:d,status:l,getOrCreateWallet:C,onAuthRequired:p,clientTEEConnection:o}),[C,d,l,p,o]);return _jsxruntime.jsx.call(void 0, I.Provider,{value:g,children:i})}exports.a = I; exports.b = He; exports.c = de; exports.d = P; exports.e = L; exports.f = _; exports.g = ne; exports.h = Re;
